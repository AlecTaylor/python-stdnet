
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Redis timeseries API &mdash; Python StdNet v0.5.1 documentation</title>
    <link rel="stylesheet" href="../static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="top" title="Python StdNet v0.5.1 documentation" href="../index.html" />
    <link rel="up" title="Battery Included" href="index.html" />
    <link rel="next" title="Examples" href="../examples/index.html" />
    <link rel="prev" title="Timeseries Models" href="timeseries.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../examples/index.html" title="Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="timeseries.html" title="Timeseries Models"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Python StdNet v0.5.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Battery Included</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="redis-timeseries-api">
<span id="redis-timeseries"></span><h1>Redis timeseries API<a class="headerlink" href="#redis-timeseries-api" title="Permalink to this headline">¶</a></h1>
<p><strong>An implementation of a timeseries data structure in</strong> <a class="reference external" href="http://redis.io/">redis</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Source:</th><td class="field-body"><a class="reference external" href="https://github.com/lsbardel/redis">https://github.com/lsbardel/redis</a></td>
</tr>
<tr class="field"><th class="field-name">Python Client:</th><td class="field-body"><a class="reference external" href="http://lsbardel.github.com/python-stdnet/">http://lsbardel.github.com/python-stdnet/</a></td>
</tr>
</tbody>
</table>
<p>Timeseries is an important data-structure not yet supported in redis,
it is represented by a unique sorted associative container,
that is to say it associates ordered unique times to values.</p>
<p>Values, which can be anything you like, are ordered with respect to times (double values),
and can be accessed by times or rank (the order of times in the timeseries).
Times are unique, that is to say in a timeseries
there will be only one value associated with a time.</p>
<p>Internally, values are added to a hash table mapping them to times.
At the same time they are added to a skip list to maintain
sorting with respect to times.</p>
<p>Implementation is almost equivalent to zsets, and they look like zsets. But they are not zsets!</p>
<p>Performance:</p>
<div class="highlight-python"><pre>O(log(N)) on INSERT and REMOVE operations
O(1) on RETRIEVAL via times</pre>
</div>
<p><strong>Contents</strong></p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#commands" id="id2">Commands</a><ul>
<li><a class="reference internal" href="#tslen" id="id3">TSLEN</a></li>
<li><a class="reference internal" href="#tsadd" id="id4">TSADD</a></li>
<li><a class="reference internal" href="#tsexists" id="id5">TSEXISTS</a></li>
<li><a class="reference internal" href="#tsget" id="id6">TSGET</a></li>
<li><a class="reference internal" href="#tsrange" id="id7">TSRANGE</a></li>
<li><a class="reference internal" href="#tsrangebytime" id="id8">TSRANGEBYTIME</a></li>
<li><a class="reference internal" href="#tscount" id="id9">TSCOUNT</a></li>
<li><a class="reference internal" href="#tsunion" id="id10">TSUNION</a></li>
<li><a class="reference internal" href="#tsinterception" id="id11">TSINTERCEPTION</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-cases" id="id12">Use cases</a></li>
<li><a class="reference internal" href="#source-code-changes" id="id13">Source code changes</a></li>
</ul>
</div>
<div class="section" id="commands">
<h2><a class="toc-backref" href="#id2">Commands</a><a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h2>
<p>There are currently seven commands which cover the basic operations of a timeseries. I tried to keep them to a minimum
but there is scope to add more.</p>
<div class="section" id="tslen">
<h3><a class="toc-backref" href="#id3">TSLEN</a><a class="headerlink" href="#tslen" title="Permalink to this headline">¶</a></h3>
<p>Size of timeseries at <tt class="docutils literal"><span class="pre">key</span></tt>, that is the number of <tt class="docutils literal"><span class="pre">rows</span></tt> in the timeseries:</p>
<div class="highlight-python"><pre>tslen key</pre>
</div>
</div>
<div class="section" id="tsadd">
<h3><a class="toc-backref" href="#id4">TSADD</a><a class="headerlink" href="#tsadd" title="Permalink to this headline">¶</a></h3>
<p>Add items to timeseries at <tt class="docutils literal"><span class="pre">key</span></tt>:</p>
<div class="highlight-python"><pre>tsadd key time1 value1 time2 value2 ...</pre>
</div>
<p>If value at <tt class="docutils literal"><span class="pre">time</span></tt> is already available, the value will be updated.</p>
</div>
<div class="section" id="tsexists">
<h3><a class="toc-backref" href="#id5">TSEXISTS</a><a class="headerlink" href="#tsexists" title="Permalink to this headline">¶</a></h3>
<p>Check if <tt class="docutils literal"><span class="pre">time</span></tt> is in timeseries at <tt class="docutils literal"><span class="pre">key</span></tt>:</p>
<div class="highlight-python"><pre>tsexists key time</pre>
</div>
</div>
<div class="section" id="tsget">
<h3><a class="toc-backref" href="#id6">TSGET</a><a class="headerlink" href="#tsget" title="Permalink to this headline">¶</a></h3>
<p>Get value at <tt class="docutils literal"><span class="pre">time</span></tt> in timeseries at <tt class="docutils literal"><span class="pre">key</span></tt>:</p>
<div class="highlight-python"><pre>tsget key time</pre>
</div>
</div>
<div class="section" id="tsrange">
<h3><a class="toc-backref" href="#id7">TSRANGE</a><a class="headerlink" href="#tsrange" title="Permalink to this headline">¶</a></h3>
<p>Range by rank:</p>
<div class="highlight-python"><pre>tsrange key start end &lt;flag&gt;</pre>
</div>
<p>Where <tt class="docutils literal"><span class="pre">start</span></tt> and <tt class="docutils literal"><span class="pre">end</span></tt> are integers following the same
Redis conventions as <tt class="docutils literal"><span class="pre">zrange</span></tt>, <tt class="docutils literal"><span class="pre">&lt;flag&gt;</span></tt> is an optional
string which can take two values: <tt class="docutils literal"><span class="pre">withtimes</span></tt> or <tt class="docutils literal"><span class="pre">novalues</span></tt>:</p>
<div class="highlight-python"><pre>tsrange key start end           -&gt; return values
tsrange key start end withtimes -&gt; return (time,value)s
tsrange key start end novalues  -&gt; return times</pre>
</div>
</div>
<div class="section" id="tsrangebytime">
<h3><a class="toc-backref" href="#id8">TSRANGEBYTIME</a><a class="headerlink" href="#tsrangebytime" title="Permalink to this headline">¶</a></h3>
<p>Range by times:</p>
<div class="highlight-python"><pre>tsrangebytime time_start time_end &lt;flag&gt;</pre>
</div>
<p>Where <tt class="docutils literal"><span class="pre">time_start</span></tt> and <tt class="docutils literal"><span class="pre">time_end</span></tt> are double (timestaps) and <tt class="docutils literal"><span class="pre">&lt;flag&gt;</span></tt>
is the same as in <tt class="docutils literal"><span class="pre">TSRANGE</span></tt>.</p>
</div>
<div class="section" id="tscount">
<h3><a class="toc-backref" href="#id9">TSCOUNT</a><a class="headerlink" href="#tscount" title="Permalink to this headline">¶</a></h3>
<p>Count element in range by <tt class="docutils literal"><span class="pre">time</span></tt>:</p>
<div class="highlight-python"><pre>tscount time_start,time_end</pre>
</div>
</div>
<div class="section" id="tsunion">
<h3><a class="toc-backref" href="#id10">TSUNION</a><a class="headerlink" href="#tsunion" title="Permalink to this headline">¶</a></h3>
<p><strong>Not implemented</strong></p>
</div>
<div class="section" id="tsinterception">
<h3><a class="toc-backref" href="#id11">TSINTERCEPTION</a><a class="headerlink" href="#tsinterception" title="Permalink to this headline">¶</a></h3>
<p><strong>Not implemented</strong></p>
</div>
</div>
<div class="section" id="use-cases">
<h2><a class="toc-backref" href="#id12">Use cases</a><a class="headerlink" href="#use-cases" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Store and manipulate financial timeseries:</p>
<div class="highlight-python"><pre>tsadd goog</pre>
</div>
</li>
<li><p class="first">A redis calendar.</p>
</li>
</ul>
</div>
<div class="section" id="source-code-changes">
<h2><a class="toc-backref" href="#id13">Source code changes</a><a class="headerlink" href="#source-code-changes" title="Permalink to this headline">¶</a></h2>
<p>I have tried, as much as possible, not to be intrusive so that it should be relatively straightforward to
track changes. In a nut shell, these are the additions/changes:</p>
<ul class="simple">
<li>Added 2 files in <tt class="docutils literal"><span class="pre">src</span></tt>: <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/t_ts.h">t_ts.h</a> and <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/t_ts.c">t_ts.c</a>.</li>
<li>Modified <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/redis.c">redis.c</a> to add timeseries commands to the command table and added the <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/t_ts.h">t_ts.h</a> include.</li>
<li>Modified <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/Makefile">Makefile</a> so that <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/t_ts.c">t_ts.c</a> is compiled.</li>
<li>Modified <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/object.c">object.c</a> in <tt class="docutils literal"><span class="pre">decrRefCount</span></tt> and added <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/t_ts.h">t_ts.h</a> include.</li>
<li>Modified <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/db.c">db.c</a> in <tt class="docutils literal"><span class="pre">typeCommand</span></tt> and added <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/t_ts.h">t_ts.h</a> include.</li>
<li>Modified <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/rdb.c">rdb.c</a> in <tt class="docutils literal"><span class="pre">rdbSaveObject</span></tt> and <tt class="docutils literal"><span class="pre">rdbLoadObject</span></tt> and added <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/t_ts.h">t_ts.h</a> include.</li>
<li>Modified <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/t_zset.c">t_zset.c</a> so that <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/t_ts.c">t_ts.c</a> can use its internals. Check <a class="reference external" href="https://github.com/lsbardel/redis/blob/timeseries/src/t_ts.h">t_ts.h</a> for details.</li>
<li>Added 1 file in <tt class="docutils literal"><span class="pre">tests/unit/type</span></tt>: <tt class="docutils literal"><span class="pre">ts.tcl</span></tt>.</li>
</ul>
<p>To run the timeseries tests:</p>
<div class="highlight-python"><pre>make test TAGS="ts"</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo"><a href="../index.html">
  <img class="logo" width="128" height="128" src="" alt="Logo"/>
</a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Redis timeseries API</a><ul>
<li><a class="reference internal" href="#commands">Commands</a><ul>
<li><a class="reference internal" href="#tslen">TSLEN</a></li>
<li><a class="reference internal" href="#tsadd">TSADD</a></li>
<li><a class="reference internal" href="#tsexists">TSEXISTS</a></li>
<li><a class="reference internal" href="#tsget">TSGET</a></li>
<li><a class="reference internal" href="#tsrange">TSRANGE</a></li>
<li><a class="reference internal" href="#tsrangebytime">TSRANGEBYTIME</a></li>
<li><a class="reference internal" href="#tscount">TSCOUNT</a></li>
<li><a class="reference internal" href="#tsunion">TSUNION</a></li>
<li><a class="reference internal" href="#tsinterception">TSINTERCEPTION</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-cases">Use cases</a></li>
<li><a class="reference internal" href="#source-code-changes">Source code changes</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="timeseries.html"
                        title="previous chapter">Timeseries Models</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../examples/index.html"
                        title="next chapter">Examples</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../sources/contrib/redis_timeseries.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../examples/index.html" title="Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="timeseries.html" title="Timeseries Models"
             >previous</a> |</li>
        <li><a href="../index.html">Python StdNet v0.5.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Battery Included</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Luca Sbardella.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.4.
    </div>
  </body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Database Backends &mdash; python stdnet v0.7.0 documentation</title>
    <link rel="stylesheet" href="../static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="top" title="python stdnet v0.7.0 documentation" href="../index.html" />
    <link rel="up" title="Backend Server and Structures" href="index.html" />
    <link rel="next" title="Transactions" href="transactions.html" />
    <link rel="prev" title="Backend Server and Structures" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="transactions.html" title="Transactions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Backend Server and Structures"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">python stdnet v0.7.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Backend Server and Structures</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="database-backends">
<span id="redis-backend"></span><h1>Database Backends<a class="headerlink" href="#database-backends" title="Permalink to this headline">¶</a></h1>
<p>Behind the scenes is the database. Currently stdnet has support for <a class="reference external" href="http://redis.io/">Redis</a> only but
an open door is left for including other backends.</p>
<div class="section" id="redis">
<h2>Redis<a class="headerlink" href="#redis" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://redis.io/">Redis</a> is an advanced key-value store where each key is associated with a value.
What makes Redis different from many other key-value databases, is that values can
be of different types:</p>
<blockquote>
<div><ul class="simple">
<li>Strings</li>
<li>Lists</li>
<li>Sets</li>
<li>Sorted Sets</li>
<li>Hash tables</li>
<li>Timeseries if you use the redis branch from <a class="reference external" href="https://github.com/lsbardel/redis">lsbardel</a>.</li>
</ul>
</div></blockquote>
<p>In other words, you can look at redis as a data structures server,
the networked equivalent of the
<a class="reference external" href="http://www2.roguewave.com/support/docs/hppdocs/stdref/index.html">standard template library in C++</a>.
And that is where stdnet get its name from,
<em>std</em> from the standard template library
and <em>net</em> from networked.</p>
<p>Redis loads and mantains the whole dataset into memory, but the dataset is persistent,
since at the same time it is saved on disk, so that when the server is restarted
data can be loaded back in memory. If you need speed, Redis is great solution.</p>
<div class="section" id="model-data">
<h3>Model data<a class="headerlink" href="#model-data" title="Permalink to this headline">¶</a></h3>
<p>Each <a class="reference internal" href="../model/models.html#stdnet.orm.StdModel" title="stdnet.orm.StdModel"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.orm.StdModel</span></tt></a> instance is mapped to a redis <strong>Hash table</strong>.
The hash table key is uniquely evaluated by the model hash and
the <em>id</em> of the model instance.</p>
<p>The hash fields and values are given by the field name and values of the
model instance.</p>
</div>
<div class="section" id="indexes">
<h3>Indexes<a class="headerlink" href="#indexes" title="Permalink to this headline">¶</a></h3>
<p>Indexes are obtained by using sets or sorted sets.</p>
</div>
<div class="section" id="parser">
<span id="redis-parser"></span><h3>Parser<a class="headerlink" href="#parser" title="Permalink to this headline">¶</a></h3>
<p>Stdnet is shipped with a redis parser written in python and a faster version
written in C. In order to use the C parser you need to have installed
<a class="reference external" href="http://cython.org/">cython</a>.
The C parser wraps the protocol parsing code in <a class="reference external" href="https://github.com/antirez/hiredis">hiredis</a> and it is available
for both windows and linux. To compile the exenstions:</p>
<div class="highlight-python"><pre>python setup.py build_ext</pre>
</div>
<p>For windows you need to install <a class="reference external" href="http://www.mingw.org/">mingw</a> and type:</p>
<div class="highlight-python"><pre>python setup.py build_ext -c mingw32</pre>
</div>
<p>If extensions are installed, the C parser will be the default parser
unless you override the <a class="reference internal" href="../utility.html#settings"><em>settings.REDIS_PARSER</em></a> value
and set it to <tt class="docutils literal"><span class="pre">python</span></tt> (you would want to do that mainly
for benchmarking reasons).</p>
<p>To check if the extensions are available:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">stdnet</span> <span class="kn">import</span> <span class="n">lib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lib</span><span class="o">.</span><span class="n">hasextensions</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="backend-data-server">
<h3>Backend data server<a class="headerlink" href="#backend-data-server" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="stdnet.BackendDataServer">
<em class="property">class </em><tt class="descclassname">stdnet.</tt><tt class="descname">BackendDataServer</tt><big>(</big><em>name</em>, <em>pickler=None</em>, <em>charset='utf-8'</em>, <em>**params</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic interface for a backend database:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> &#8211; name of database, such as <strong>redis</strong>, <strong>couchdb</strong>, etc..</li>
<li><strong>params</strong> &#8211; dictionary of configuration parameters</li>
<li><strong>pickler</strong> &#8211; calss for serializing and unserializing data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>It must implement the <em>loads</em> and <em>dumps</em> methods.</p>
<dl class="method">
<dt id="stdnet.BackendDataServer.disconnect">
<tt class="descname">disconnect</tt><big>(</big><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.disconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Disconnect the connection.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.isempty">
<tt class="descname">isempty</tt><big>(</big><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.isempty" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns <tt class="xref docutils literal"><span class="pre">True</span></tt> if the database has no keys.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.instance_keys">
<tt class="descname">instance_keys</tt><big>(</big><em>obj</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.instance_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of database keys used by instance <em>obj</em></p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.transaction">
<tt class="descname">transaction</tt><big>(</big><em>pipelined=True</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.transaction" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a transaction instance</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.save_object">
<tt class="descname">save_object</tt><big>(</big><em>obj</em>, <em>transaction=None</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.save_object" title="Permalink to this definition">¶</a></dt>
<dd><p>Save or updated an instance of a model to the back-end database:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><strong>obj</strong> &#8211; instance of <a class="reference internal" href="../model/models.html#model-model"><em>StdModel</em></a>
to add/update to the database</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Parameer transaction:</th></tr>
<tr><td>&nbsp;</td><td class="field-body">optional transaction instance.</td>
</tr>
</tbody>
</table>
<p>Raises <a class="reference internal" href="../utility.html#stdnet.FieldValueError" title="stdnet.FieldValueError"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.FieldValueError</span></tt></a> if the instance is not valid.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.delete_object">
<tt class="descname">delete_object</tt><big>(</big><em>obj</em>, <em>transaction=None</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.delete_object" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete an object from the data server and clean up indices.
Called to clear a model instance.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>obj</strong> &#8211; instance of <a class="reference internal" href="../model/models.html#stdnet.orm.StdModel" title="stdnet.orm.StdModel"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.orm.StdModel</span></tt></a></li>
<li><strong>deleted</strong> &#8211; a list or <tt class="xref docutils literal"><span class="pre">None</span></tt>. If a list, deleted keys
will be appended to it.</li>
<li><strong>multi_field</strong> &#8211; if <tt class="xref docutils literal"><span class="pre">True</span></tt> the multifield ids (if any)
will be removed. Default <tt class="xref docutils literal"><span class="pre">True</span></tt>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.get_many">
<tt class="descname">get_many</tt><big>(</big><em>keys</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.get_many" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch a bunch of keys from the cache. For certain backends (memcached,
pgsql) this can be <em>much</em> faster when fetching multiple values.</p>
<p>Returns a dict mapping each key in keys to its value. If the given
key is missing, it will be missing from the response dict.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.has_key">
<tt class="descname">has_key</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.has_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns True if the key is in the cache and has not expired.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.incr">
<tt class="descname">incr</tt><big>(</big><em>key</em>, <em>delta=1</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.incr" title="Permalink to this definition">¶</a></dt>
<dd><p>Add delta to value in the cache. If the key does not exist, raise a
ValueError exception.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.decr">
<tt class="descname">decr</tt><big>(</big><em>key</em>, <em>delta=1</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.decr" title="Permalink to this definition">¶</a></dt>
<dd><p>Subtract delta from value in the cache.
If the key does not exist, raise a ValueError exception.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.delete_many">
<tt class="descname">delete_many</tt><big>(</big><em>keys</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.delete_many" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a bunch of values in the cache at once.  For certain backends
(memcached), this is much more efficient than calling delete() multiple
times.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.clear">
<tt class="descname">clear</tt><big>(</big><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.clear" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove <em>all</em> values from the database at once.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.list">
<tt class="descname">list</tt><big>(</big><em>id</em>, <em>timeout=0</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.list" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an instance of <a class="reference internal" href="structures.html#stdnet.List" title="stdnet.List"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.List</span></tt></a>
for a given <em>id</em>.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.hash">
<tt class="descname">hash</tt><big>(</big><em>id</em>, <em>timeout=0</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.hash" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an instance of <a class="reference internal" href="structures.html#stdnet.HashTable" title="stdnet.HashTable"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.HashTable</span></tt></a> structure
for a given <em>id</em>.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.ts">
<tt class="descname">ts</tt><big>(</big><em>id</em>, <em>timeout=0</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.ts" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an instance of <a class="reference internal" href="structures.html#stdnet.HashTable" title="stdnet.HashTable"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.HashTable</span></tt></a> structure
for a given <em>id</em>.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.unordered_set">
<tt class="descname">unordered_set</tt><big>(</big><em>id</em>, <em>timeout=0</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.unordered_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an instance of <a class="reference internal" href="structures.html#stdnet.Set" title="stdnet.Set"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.Set</span></tt></a> structure
for a given <em>id</em>.</p>
</dd></dl>

<dl class="method">
<dt id="stdnet.BackendDataServer.ordered_set">
<tt class="descname">ordered_set</tt><big>(</big><em>id</em>, <em>timeout=0</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#stdnet.BackendDataServer.ordered_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Return an instance of <a class="reference internal" href="structures.html#stdnet.OrderedSet" title="stdnet.OrderedSet"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.OrderedSet</span></tt></a> structure
for a given <em>id</em>.</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo">
<a href="../index.html">
  <img class="logo" width="200" src="../static/net.jpg" alt="Logo"/>
</a>
</p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Database Backends</a><ul>
<li><a class="reference internal" href="#redis">Redis</a><ul>
<li><a class="reference internal" href="#model-data">Model data</a></li>
<li><a class="reference internal" href="#indexes">Indexes</a></li>
<li><a class="reference internal" href="#parser">Parser</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">API</a><ul>
<li><a class="reference internal" href="#backend-data-server">Backend data server</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Backend Server and Structures</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="transactions.html"
                        title="next chapter">Transactions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../sources/backends/backends.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="transactions.html" title="Transactions"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Backend Server and Structures"
             >previous</a> |</li>
        <li><a href="../index.html">python stdnet v0.7.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Backend Server and Structures</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010-2011, Luca Sbardella.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3900561-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using Models &mdash; python stdnet v0.7.0 documentation</title>
    <link rel="stylesheet" href="../static/celery.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="top" title="python stdnet v0.7.0 documentation" href="../index.html" />
    <link rel="up" title="Tutorials &amp; Examples" href="index.html" />
    <link rel="next" title="Query your Models" href="query.html" />
    <link rel="prev" title="Tutorials &amp; Examples" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="query.html" title="Query your Models"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Tutorials &amp; Examples"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">python stdnet v0.7.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Tutorials &amp; Examples</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="using-models">
<span id="tutorial"></span><h1>Using Models<a class="headerlink" href="#using-models" title="Permalink to this headline">¶</a></h1>
<p>Here we deal with model implementation and creating instances persistent
in a backend database.</p>
<div class="section" id="writing-models">
<span id="creating-models"></span><h2>Writing Models<a class="headerlink" href="#writing-models" title="Permalink to this headline">¶</a></h2>
<p>Defining stdnet <em>models</em> is achieved by subclassing the
<a class="reference internal" href="../model/models.html#stdnet.orm.StdModel" title="stdnet.orm.StdModel"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.orm.StdModel</span></tt></a> class. The following
snipped implements two models, <tt class="docutils literal"><span class="pre">Author</span></tt> and <tt class="docutils literal"><span class="pre">Book</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">stdnet</span> <span class="kn">import</span> <span class="n">orm</span>

<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">orm</span><span class="o">.</span><span class="n">StModel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">SymbolField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">orm</span><span class="o">.</span><span class="n">StdModel</span><span class="p">):</span>
    <span class="n">title</span>  <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Author</span><span class="p">,</span> <span class="n">related_name</span> <span class="o">=</span> <span class="s">&#39;books&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The API should look familiar if you have come across <a class="reference external" href="https://www.djangoproject.com/">django</a>
web framework. <a class="reference internal" href="../model/fields.html#model-field"><em>Fields</em></a> (name in the Author model,
title and author in the Book model) are specified as attribute of models.
But while fields in django are the python representation of the columns in the
backend database table, fields in stdnet are stored in different ways, depending
on the <a class="reference internal" href="../backends/index.html#db-index"><em>backend</em></a> used.
For example, in <a class="reference internal" href="../backends/redis.html#redis-server"><em>redis</em></a>, fields are equivalent to the
fields of a redis hash table which represents an instance of a model.</p>
</div>
<div class="section" id="an-application">
<span id="tutorial-application"></span><h2>An application<a class="headerlink" href="#an-application" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s start with tutorial application: a small hedge fund.
You never know it may become useful in the future!</p>
<p>The application uses the following three models,</p>
<ul class="simple">
<li>A <tt class="docutils literal"><span class="pre">Fund</span></tt> which stores information about several <tt class="docutils literal"><span class="pre">Position</span></tt></li>
<li>A <tt class="docutils literal"><span class="pre">Position</span></tt> is an investment on a particular funancial <tt class="docutils literal"><span class="pre">Instrument</span></tt>.</li>
</ul>
<p>A minimal <tt class="docutils literal"><span class="pre">stdnet</span></tt> implementation can look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">stdnet</span> <span class="kn">import</span> <span class="n">orm</span>

<span class="k">class</span> <span class="nc">Fund</span><span class="p">(</span><span class="n">orm</span><span class="o">.</span><span class="n">StdModel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">SymbolField</span><span class="p">(</span><span class="n">unique</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">ccy</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">SymbolField</span><span class="p">()</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">Instrument</span><span class="p">(</span><span class="n">orm</span><span class="o">.</span><span class="n">StdModel</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">SymbolField</span><span class="p">(</span><span class="n">unique</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">ccy</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">SymbolField</span><span class="p">()</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">SymbolField</span><span class="p">()</span>
    <span class="n">prices</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">ListField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">Position</span><span class="p">(</span><span class="n">orm</span><span class="o">.</span><span class="n">StdModel</span><span class="p">):</span>
    <span class="n">instrument</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Instrument</span><span class="p">)</span>
    <span class="n">fund</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Fund</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instrument</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="s">&#39;-dt&#39;</span>
</pre></div>
</div>
<p>If you are familiar with <a class="reference external" href="https://www.djangoproject.com/">django</a> you will see several similarities and you should be able to understand,
with a certain degree of confidence, what it is going on.
The only difference is the <tt class="docutils literal"><span class="pre">prices</span></tt> <a class="reference internal" href="../model/fields.html#stdnet.orm.ListField" title="stdnet.orm.ListField"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.orm.ListField</span></tt></a>
in the <tt class="docutils literal"><span class="pre">Instrument</span></tt> model which is
not available in a traditional relational database.</p>
<div class="section" id="the-metaclass">
<h3>The metaclass<a class="headerlink" href="#the-metaclass" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">Position</span></tt> models specifies a <tt class="docutils literal"><span class="pre">Meta</span></tt> class with an <tt class="docutils literal"><span class="pre">ordering</span></tt> attribute.
When provided, as in this case, the Meta class fields are used by the <tt class="docutils literal"><span class="pre">orm</span></tt>
to customize the build of the <a class="reference internal" href="../model/models.html#stdnet.orm.Metaclass" title="stdnet.orm.Metaclass"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.orm.Metaclass</span></tt></a> for the model.
In this case we instruct the mapper to manage the <tt class="docutils literal"><span class="pre">Position</span></tt> model
as ordered with respect to the <a class="reference internal" href="../model/fields.html#stdnet.orm.DateField" title="stdnet.orm.DateField"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.orm.DateField</span></tt></a> <tt class="docutils literal"><span class="pre">dt</span></tt>
in descending order. Check the  <a class="reference internal" href="sorting.html#sorting"><em>sorting</em></a>
documentation for more details or ordering and sorting.</p>
</div>
</div>
<div class="section" id="registering-models">
<h2>Registering Models<a class="headerlink" href="#registering-models" title="Permalink to this headline">¶</a></h2>
<p>Before playing with the API you need to <a class="reference internal" href="../model/models.html#register-model"><em>register the models</em></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">orm</span>

<span class="n">orm</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Fund</span><span class="p">,</span> <span class="s">&#39;redis://my.host.name:6379/?db=1&#39;</span><span class="p">)</span>
<span class="n">orm</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Instrument</span><span class="p">,</span> <span class="s">&#39;redis://my.host.name:6379/?db=1&#39;</span><span class="p">)</span>
<span class="n">orm</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Position</span><span class="p">,</span> <span class="s">&#39;redis://my.host.name:6379/?db=2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="one-to-many-relationships">
<span id="one-to-many"></span><h2>One-to-many relationships<a class="headerlink" href="#one-to-many-relationships" title="Permalink to this headline">¶</a></h2>
<p>The <em>Position</em> model contains two <a class="reference internal" href="../model/fields.html#stdnet.orm.ForeignKey" title="stdnet.orm.ForeignKey"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.orm.ForeignKey</span></tt></a> fields.
In the context of relational databases a
<a class="reference external" href="http://en.wikipedia.org/wiki/Foreign_key">foreign key</a> is
a referential constraint between two tables.</p>
<p>For stdnet is exactly the same thing. The field store the <tt class="docutils literal"><span class="pre">id</span></tt> of a
related <a class="reference internal" href="../model/models.html#stdnet.orm.StdModel" title="stdnet.orm.StdModel"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.orm.StdModel</span></tt></a> instance.
Behind the scenes, this functionality is implemented by Python <a class="reference external" href="http://users.rcn.com/python/download/Descriptor.htm">descriptors</a>.
This shouldn&#8217;t really matter to you, but we point it out here for the curious.</p>
</div>
<div class="section" id="id1">
<h2>Using Models<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Using models is equivalent to executing queries to the backend database.
Once again, the API is very similar to executing queries in <a class="reference external" href="https://www.djangoproject.com/">django</a>.
Once you&#8217;ve created your models, <tt class="docutils literal"><span class="pre">stdnet</span></tt> automatically gives you
a data-server abstraction API that lets you create, retrieve,
update and delete objects.</p>
<div class="section" id="creating-objects">
<h3>Creating objects<a class="headerlink" href="#creating-objects" title="Permalink to this headline">¶</a></h3>
<p>An instance of a <a class="reference internal" href="../model/models.html#stdnet.orm.StdModel" title="stdnet.orm.StdModel"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.orm.StdModel</span></tt></a>, an object for clarity,
is mapped to a hash table in the <a class="reference internal" href="../backends/index.html#stdnet.BackendDataServer" title="stdnet.BackendDataServer"><tt class="xref py py-class docutils literal"><span class="pre">stdnet.BackendDataServer</span></tt></a> backend.
To create an object, instantiate it using keyword arguments to the
model class, then call <tt class="docutils literal"><span class="pre">save()</span></tt> to save it to the data-server.
Here&#8217;s an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">Fund</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Markowitz&#39;</span><span class="p">,</span> <span class="n">ccy</span><span class="o">=</span><span class="s">&#39;EUR&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="go">Fund: Markowitz</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">id</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;Markowitz&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">ccy</span>
<span class="go">&#39;EUR&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">description</span>
<span class="go">&#39;&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><p class="logo">
<a href="../index.html">
  <img class="logo" width="200" src="../static/net.jpg" alt="Logo"/>
</a>
</p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Using Models</a><ul>
<li><a class="reference internal" href="#writing-models">Writing Models</a></li>
<li><a class="reference internal" href="#an-application">An application</a><ul>
<li><a class="reference internal" href="#the-metaclass">The metaclass</a></li>
</ul>
</li>
<li><a class="reference internal" href="#registering-models">Registering Models</a></li>
<li><a class="reference internal" href="#one-to-many-relationships">One-to-many relationships</a></li>
<li><a class="reference internal" href="#id1">Using Models</a><ul>
<li><a class="reference internal" href="#creating-objects">Creating objects</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Tutorials &amp; Examples</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="query.html"
                        title="next chapter">Query your Models</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../sources/examples/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="query.html" title="Query your Models"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Tutorials &amp; Examples"
             >previous</a> |</li>
        <li><a href="../index.html">python stdnet v0.7.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Tutorials &amp; Examples</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2010-2011, Luca Sbardella.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3900561-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>